# å‚æ•°è¯¦ç»†åˆ†æ


## ğŸ¯ **å…³é”®å‚æ•°é…ç½®è¡¨**

| å‚æ•° | æ¨èå€¼ | å•ä½ | è¯´æ˜ |
|------|--------|------|------|
| `miniPosX` | 0.05-0.8 | å½’ä¸€åŒ– | è·ç¦»å·¦è¾¹è· |
| `miniPosY` | 0.05-0.8 | å½’ä¸€åŒ– | è·ç¦»åº•éƒ¨è· |
| `w` | 0.2-0.4 | å½’ä¸€åŒ– | ç›¸å¯¹å±å¹•å®½åº¦ |
| `h` | 0.25-0.45 | å½’ä¸€åŒ– | ç›¸å¯¹å±å¹•é«˜åº¦ |
| `padding` | 5-20 | åƒç´  | äº¤äº’æ‰©å±•åŒºåŸŸ |
| `zoomFactor` | 1.5-3.0 | å€ç‡ | è§†å›¾ç¼©æ”¾çº§åˆ« |
| `camX`, `camY` | åŠ¨æ€ | ä¸–ç•Œåæ ‡ | å®æ—¶æ›´æ–° |
| `bounds0-3` | å›ºå®š | ä¸–ç•Œåæ ‡ | æ¸¸æˆåœ°å›¾èŒƒå›´ |



## ğŸ“Š **Uniform å‚æ•°æ€»è§ˆ**

### **1. å°åœ°å›¾ä½ç½®ä¸å°ºå¯¸å‚æ•°**
```glsl
uniform float miniPosX;    // å°åœ°å›¾å·¦ä¸‹è§’Xåæ ‡ (0-1)
uniform float miniPosY;    // å°åœ°å›¾å·¦ä¸‹è§’Yåæ ‡ (0-1)
uniform float w;           // å°åœ°å›¾å®½åº¦ (0-1)
uniform float h;           // å°åœ°å›¾é«˜åº¦ (0-1)
uniform float padding;     // æ£€æµ‹åŒºåŸŸæ‰©å±•è¾¹è· (åƒç´ )
```

**è¯´æ˜**ï¼š
- ä½¿ç”¨**æ ‡å‡†åŒ–åæ ‡**ç³»ç»Ÿï¼šæ•´ä¸ªå±å¹•ä¸º [0,1]Ã—[0,1]
- å·¦ä¸‹è§’ä¸º(0,0)ï¼Œå³ä¸Šè§’ä¸º(1,1)
- `padding` ç”¨äºæ‰©å±•å°åœ°å›¾çš„äº¤äº’æ£€æµ‹åŒºåŸŸï¼Œå•ä½æ˜¯åƒç´ ï¼ˆéœ€è¦è½¬æ¢ä¸ºæ ‡å‡†åŒ–åæ ‡ï¼‰

### **2. è§†å›¾æ§åˆ¶å‚æ•°**
```glsl
uniform float zoomFactor;  // ç¼©æ”¾å› å­ (æ¨è >1.0)
```

**å€¼åŸŸåˆ†æ**ï¼š
- `zoomFactor = 1.0`ï¼šæ— ç¼©æ”¾
- `zoomFactor > 1.0`ï¼šæ”¾å¤§ï¼ˆè§†é‡èŒƒå›´å˜å°ï¼‰
- `zoomFactor < 1.0`ï¼šç¼©å°ï¼ˆè§†é‡èŒƒå›´å˜å¤§ï¼‰
- **ç‰¹æ®Šå€¼**ï¼š
  - `zoomFactor = 2.0`ï¼šè§†é‡ç¼©å°ä¸€åŠ
  - `zoomFactor = 0.5`ï¼šè§†é‡æ‰©å¤§ä¸€å€

### **3. ç›¸æœº/ç©å®¶ä½ç½®**
```glsl
uniform float camX;  // ç›¸æœºXåæ ‡ï¼ˆæ¸¸æˆä¸–ç•Œåæ ‡ï¼‰
uniform float camY;  // ç›¸æœºYåæ ‡ï¼ˆæ¸¸æˆä¸–ç•Œåæ ‡ï¼‰
```

**åæ ‡ç³»è½¬æ¢**ï¼š
```
æ¸¸æˆä¸–ç•Œåæ ‡ â†’ åœ°å›¾æ ‡å‡†åŒ–åæ ‡ â†’ å°åœ°å›¾UVåæ ‡
```

### **4. åœ°å›¾è¾¹ç•Œå‚æ•°**
```glsl
uniform float bounds0;  // ä¸Šè¾¹ç•Œ (Yæœ€å¤§å€¼)
uniform float bounds1;  // ä¸‹è¾¹ç•Œ (Yæœ€å°å€¼)
uniform float bounds2;  // å·¦è¾¹ç•Œ (Xæœ€å°å€¼)
uniform float bounds3;  // å³è¾¹ç•Œ (Xæœ€å¤§å€¼)
```

**è¾¹ç•Œå®šä¹‰ç¤ºä¾‹**ï¼š
```
å‡è®¾åœ°å›¾ä» (-100, -50) åˆ° (200, 150)
bounds0 = 150   // ä¸Šè¾¹ç•Œ (max Y)
bounds1 = -50   // ä¸‹è¾¹ç•Œ (min Y)
bounds2 = -100  // å·¦è¾¹ç•Œ (min X)
bounds3 = 200   // å³è¾¹ç•Œ (max X)
```

### **5. æ§åˆ¶å¼€å…³**
```glsl
uniform bool byp;  // ç»•è¿‡æ ‡å¿— (true=ç¦ç”¨æ•ˆæœ)
```

## ğŸ” **å‚æ•°è®¡ç®—é€»è¾‘**

### **A. åœ°å›¾å°ºå¯¸è®¡ç®—**
```glsl
vec2 mapSize = vec2(
    bounds3 - bounds2,  // åœ°å›¾å®½åº¦ (Xæ–¹å‘)
    bounds0 - bounds1   // åœ°å›¾é«˜åº¦ (Yæ–¹å‘)
);
```

### **B. å°åœ°å›¾æ˜¾ç¤ºå°ºå¯¸è®¡ç®—**
```glsl
vec2 minimapSize = vec2(
    displaySize.x,  // ä½¿ç”¨æŒ‡å®šçš„å®½åº¦
    mapSize.y / mapSize.x / 3.6 * 6.4 * displaySize.x
);
```

**æ¯”ä¾‹å› å­åˆ†æ**ï¼š
- `6.4/3.6 â‰ˆ 1.777`ï¼šè¿™æ˜¯640Ã—360çš„æ ‡å‡†å®½é«˜æ¯”
- ç¡®ä¿å°åœ°å›¾**ä¿æŒåœ°å›¾çš„åŸå§‹å®½é«˜æ¯”**

### **C. æ ‡å‡†åŒ–åæ ‡è½¬æ¢**

#### **åƒç´ åæ ‡ â†” æ ‡å‡†åŒ–åæ ‡**
```glsl
// åƒç´ åæ ‡è½¬æ ‡å‡†åŒ–åæ ‡
float normalizedX = pixelX / 640.0;
float normalizedY = pixelY / 360.0;

// æ ‡å‡†åŒ–åæ ‡è½¬åƒç´ åæ ‡
float pixelX = normalizedX * 640.0;
float pixelY = normalizedY * 360.0;
```

#### **åœ°å›¾åæ ‡ â†” å°åœ°å›¾åæ ‡**
```glsl
// åœ°å›¾åæ ‡ â†’ å°åœ°å›¾åæ ‡ (åœ¨ mapToMiniMap å‡½æ•°ä¸­)
vec2 normalizedMapPos = (worldPos - vec2(bounds2, bounds1)) / mapSize;
vec2 minimapPos = normalizedMapPos * minimapSize;
```

## ğŸ“ **å‚æ•°ä¾èµ–å…³ç³»**

### **1. å¼ºä¾èµ–å…³ç³»**
```
camX, camY å¿…é¡»åœ¨åœ°å›¾è¾¹ç•Œå†…ï¼š
    bounds2 â‰¤ camX â‰¤ bounds3
    bounds1 â‰¤ camY â‰¤ bounds0
    
å¦åˆ™å°åœ°å›¾æ˜¾ç¤ºå¼‚å¸¸
```

### **2. å°ºå¯¸çº¦æŸå…³ç³»**
```
å°åœ°å›¾æ˜¾ç¤ºåŒºåŸŸä¸èƒ½è¶…å‡ºå±å¹•ï¼š
    0 â‰¤ miniPosX â‰¤ 1
    0 â‰¤ miniPosY â‰¤ 1
    miniPosX + w â‰¤ 1
    miniPosY + h â‰¤ 1
```

### **3. ç¼©æ”¾å› å­çº¦æŸ**
```
zoomFactor > 0  // å¿…é¡»ä¸ºæ­£æ•°
å»ºè®®èŒƒå›´ï¼š0.25 â‰¤ zoomFactor â‰¤ 4.0
```

## âš ï¸ **è¾¹ç•Œæ¡ä»¶ä¸å¼‚å¸¸å¤„ç†**

### **A. å±é™©å‚æ•°ç»„åˆ**
```javascript
// 1. åœ°å›¾å°ºå¯¸ä¸ºé›¶ï¼ˆé™¤é›¶é”™è¯¯ï¼‰
if (bounds3 == bounds2 || bounds0 == bounds1) {
    // éœ€è¦å¤„ç†ï¼šmapSize = vec2(1.0, 1.0)
}

// 2. ç¼©æ”¾å› å­ä¸ºé›¶æˆ–è´Ÿå€¼
if (zoomFactor <= 0.0) {
    zoomFactor = 1.0;  // é‡ç½®ä¸ºé»˜è®¤å€¼
}

// 3. å°åœ°å›¾å°ºå¯¸ä¸ºé›¶
if (w == 0.0 || h == 0.0) {
    // å°åœ°å›¾ä¸å¯è§
}
```

### **B. ç›¸æœºä½ç½®çº¦æŸ**
```glsl
// ç›¸æœºåœ¨å°åœ°å›¾ä¸­çš„ä½ç½®é™åˆ¶
vec2 minCam = displaySize * 0.5 / zoomFactor;
vec2 maxCam = minimapSize - minCam;

// ç¡®ä¿ç›¸æœºä¸ä¼šè¶…å‡ºå°åœ°å›¾è¾¹ç•Œ
cam.x = clamp(player.x, minCam.x, maxCam.x);
cam.y = clamp(player.y, minCam.y, maxCam.y);
```

## ğŸ“ˆ **å‚æ•°ä¼˜åŒ–å»ºè®®**

### **1. é¢„è®¡ç®—å‚æ•°**
```glsl
// å¯ä»¥é¢„è®¡ç®—çš„å˜é‡
uniform vec2 mapSize;      // ä»£æ›¿ bounds0-bounds3
uniform vec2 miniPos;      // ä»£æ›¿ miniPosX, miniPosY
uniform vec2 displaySize;  // ä»£æ›¿ w, h
```

### **2. æ·»åŠ éªŒè¯uniform**
```glsl
uniform int debugMode;     // è°ƒè¯•æ¨¡å¼å¼€å…³
uniform float aspectRatio; // å±å¹•å®½é«˜æ¯” (640/360)
```

### **3. åŠ¨æ€å‚æ•°**
```glsl
// å¯ä»¥åŠ¨æ€è°ƒæ•´çš„å‚æ•°
uniform float miniMapOpacity;  // å°åœ°å›¾é€æ˜åº¦
uniform vec3 miniMapTint;      // å°åœ°å›¾è‰²è°ƒ
uniform float outlineThickness; // è¾¹æ¡†åšåº¦
```

## ğŸ® **ä½¿ç”¨åœºæ™¯å‚æ•°é…ç½®**

### **åœºæ™¯1ï¼šå…¨å±å°åœ°å›¾**
```javascript
// å°åœ°å›¾è¦†ç›–æ•´ä¸ªå±å¹•ï¼ˆè°ƒè¯•ç”¨ï¼‰
miniPosX = 0.0
miniPosY = 0.0
w = 1.0
h = 1.0
zoomFactor = 1.0
```

### **åœºæ™¯2ï¼šå³ä¸‹è§’å°åœ°å›¾**
```javascript
// ç»å…¸ä½ç½®ï¼šå±å¹•å³ä¸‹è§’
miniPosX = 0.7  // è·ç¦»å³è¾¹30%
miniPosY = 0.1  // è·ç¦»åº•éƒ¨10%
w = 0.25        // å å±å¹•å®½åº¦25%
h = 0.3         // å å±å¹•é«˜åº¦30%
```

### **åœºæ™¯3ï¼šè·Ÿéšå¼å°åœ°å›¾**
```javascript
// å°åœ°å›¾ä½ç½®éšç›¸æœºç§»åŠ¨
miniPosX = clamp(camX, 0.0, 1.0-w)
miniPosY = clamp(camY, 0.0, 1.0-h)
```

## ğŸ”§ **è°ƒè¯•å‚æ•°**

### **A. å¯è§†åŒ–å‚æ•°å½±å“**
```glsl
// æ·»åŠ è°ƒè¯•å¯è§†åŒ–
if (debugMode == 1) {
    // æ˜¾ç¤ºå°åœ°å›¾è¾¹ç•Œ
    float border = 0.005;
    bool isBorder = abs(vUv.x - miniPosX) < border || 
                    abs(vUv.x - (miniPosX + w)) < border ||
                    abs(vUv.y - miniPosY) < border || 
                    abs(vUv.y - (miniPosY + h)) < border;
    
    if (isBorder) {
        fragColor = vec4(1.0, 0.0, 0.0, 1.0);
    }
}
```

### **B. å‚æ•°èŒƒå›´ç›‘æ§**
```glsl
// æ£€æŸ¥å‚æ•°æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
bool validParams = true;
validParams = validParams && (zoomFactor > 0.0);
validParams = validParams && (w > 0.0 && h > 0.0);
validParams = validParams && (mapSize.x > 0.0 && mapSize.y > 0.0);

if (!validParams) {
    fragColor = vec4(1.0, 0.0, 0.0, 0.5); // åŠé€æ˜çº¢è‰²é”™è¯¯æç¤º
}
```

## ğŸ“Š **å‚æ•°ä¼ è¾“å»ºè®®**

### **WebGL uniform è®¾ç½®**
```javascript
// è®¾ç½®uniformçš„JavaScriptç¤ºä¾‹
gl.uniform1f(miniPosXLoc, 0.1);        // å·¦ä¸‹è§’xä½ç½®
gl.uniform1f(miniPosYLoc, 0.1);        // å·¦ä¸‹è§’yä½ç½®
gl.uniform1f(wLoc, 0.3);              // å®½åº¦30%
gl.uniform1f(hLoc, 0.4);              // é«˜åº¦40%
gl.uniform1f(paddingLoc, 10.0);       // 10åƒç´ è¾¹è·
gl.uniform1f(zoomFactorLoc, 2.0);     // 2å€ç¼©æ”¾
gl.uniform1f(camXLoc, playerX);       // ç©å®¶xåæ ‡
gl.uniform1f(camYLoc, playerY);       // ç©å®¶yåæ ‡
gl.uniform1f(bounds0Loc, mapMaxY);    // åœ°å›¾ä¸Šè¾¹ç•Œ
gl.uniform1f(bounds1Loc, mapMinY);    // åœ°å›¾ä¸‹è¾¹ç•Œ
gl.uniform1f(bounds2Loc, mapMinX);    // åœ°å›¾å·¦è¾¹ç•Œ
gl.uniform1f(bounds3Loc, mapMaxX);    // åœ°å›¾å³è¾¹ç•Œ
gl.uniform1i(bypLoc, false);          // å¯ç”¨å°åœ°å›¾
```

